"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var TWidget=function(){function i(e,t,n){_classCallCheck(this,i),this.containers=[],this.sourceid="214321562187",this.url="http://api.taboola.com/1.0/json/"+e+"/recommendations.get?app.type="+t+"&app.apikey="+n+"&source.url=http://www.site.com/videos/"+this.sourceid+".html"}return _createClass(i,[{key:"register",value:function(e,t,n,i){var r={elementId:e,type:t,count:n,template:i=i||this.generateWidgetItem};return this.containers.push(r),new Promise(function(e,t){r.resolved=e,r.rejected=t})}},{key:"build",value:function(){var r=this;this.containers&&this.containers.forEach(function(t){var n,e,i=document.getElementById(t.elementId);i?(n=r.getCacheKey(t),(e=localStorage.getItem(n))?r.buildWidget(i,JSON.parse(e),t.template,t.resolved):fetch(r.buildUrl(t)).then(function(e){e.json().then(function(e){e.list&&e.list.length&&localStorage.setItem(n,JSON.stringify(e)),r.buildWidget(i,e,t.template,t.resolved)}).catch(function(e){r.logError("Failed to parse widget ' "+t.container+" ' data",e,t.rejected)})}).catch(function(e){r.logError("Failed to fetch widget ' "+t.container+" '  data",e,t.rejected)})):r.logError("Failed to find widget container element '"+t.container+"'",reason,t.rejected)})}},{key:"getCacheKey",value:function(e){return"twidget_"+e.container+"_"+e.count+"_"+e.type}},{key:"buildUrl",value:function(e){return this.url+"&count="+e.count+"&source.type="+e.type+"&source.id="+this.sourceid}},{key:"buildWidget",value:function(e,t,n,i){var r,a=this,t=t.list;t&&(r="",t.forEach(function(e){r+=n(a.generateItemDetails(e))}),e.innerHTML=r,i)&&i(e)}},{key:"generateItemDetails",value:function(e){return{origin:e.origin,url:e.url,thumbnail:e.thumbnail[0].url,name:e.name,branding:e.branding,type:e.type}}},{key:"generateWidgetItem",value:function(e){return"\n            <div class='widget-item'>\n                <a href="+e.url+" target="+("sponsored"===e.origin?"_blank":"_self")+">\n                    <div class='widget-item-image' style='background-image:url("+e.thumbnail+')\'></div>\n                    <div class="widget-item-caption">'+e.name+"</div>\n                    "+("sponsored"===e.origin?e.branding:"")+"\n                </a>\n            </div>\n        "}},{key:"logError",value:function(e,t,n){e="ERROR: "+e+" [reason= "+t+"]";console.log(e),n&&n(e)}}]),i}();module.exports=TWidget;